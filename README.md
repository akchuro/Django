Сервис управления продажами и генерации аналитического отчета
Это Django-приложение, предназначенное для учета клиентов, заказов и продуктов, а также для генерации аналитических отчетов по продажам.

Описание проекта
Проект представляет собой RESTful API на базе Django и Django REST Framework, который позволяет управлять данными о продажах и формировать важные аналитические сводки в формате PDF. Для удобства работы с API интегрирована интерактивная документация Swagger UI.

Основной функционал
1. CRUD для клиентов
Ведётся учёт клиентов со следующими полями:

ФИО (full_name)

Email (email, уникальный)

Название компании (company_name, опционально)

Номер телефона (phone)

Дата регистрации (created_at, автоматически генерируется)

Персональная скидка (discount_percent, в процентах)

2. CRUD для продуктов
Управление продуктами включает поля:

Название (name)

Описание (description)

Цена за единицу (price)

Остаток на складе (stock_quantity)

Доступен для заказа (is_active)

Скидка на товар (discount_percent, в процентах)

3. Оформление заказов
Клиенты могут оформлять заказы, которые содержат:

Список товаров и их количество

Дату и статус (возможные статусы: draft, confirmed, shipped, cancelled)

Автоматический расчёт итоговой суммы по формуле:
Итог = Сумма_по_позициям - Скидки + Налоги + Доставка
Где:

Сумма_по_позициям: sum(цена
товара
умноженная на количество)

Скидки: включают процентную скидку по клиенту, индивидуальные скидки по товару, глобальные акции (например, -10% при заказе более чем на 150 000 KGS).

Налоги: применяются при необходимости (например, НДС 12%).

Доставка: фиксированная сумма или бесплатная при сумме заказа выше 2000 KGS.

4. Списание со склада
При изменении статуса заказа на confirmed (подтвержден) соответствующее количество товара автоматически списывается со stock_quantity продукта.

5. PDF-отчет по продажам
Генерируется по заданному диапазону дат (start_date, end_date) и содержит:

Общую выручку

Количество заказов

Топ-5 клиентов по выручке

Самый популярный товар (по количеству)

Таблицу всех заказов (дата, клиент, сумма, статус)
Отчет формируется с использованием HTML-шаблона Jinja2 и генерируется в PDF с помощью библиотеки WeasyPrint.

6. REST API
Предоставляет следующие эндпоинты для взаимодействия с данными:

/api/products/

/api/customers/

/api/orders/

/api/orders/{id}/status/ (для обновления статуса заказа)

/api/reports/sales/?start=YYYY-MM-DD&end=YYYY-MM-DD (для генерации PDF-отчета)

Стек технологий
Python: 3.10+

Django: 5.2.3

Django REST Framework: 3.16.0

База данных: SQLite3 (для локальной разработки)

Генерация PDF: WeasyPrint

Шаблонизатор: Jinja2

Документация API: drf-yasg (Swagger UI)

Установка и запуск проекта
Следуйте этим шагам для установки и запуска проекта на вашем локальном компьютере.

1. Клонирование репозитория
Bash

git clone <ваш_URL_репозитория_GitLab>
cd <название_вашего_проекта> # Например, cd Test
2. Создание и активация виртуального окружения
Настоятельно рекомендуется использовать виртуальное окружение для управления зависимостями.

Bash

python -m venv venv
# Для Windows
.\venv\Scripts\activate
# Для macOS/Linux
source venv/bin/activate
3. Установка зависимостей
Создайте файл requirements.txt в корне вашего проекта со следующим содержимым:

asgiref==3.8.1
Brotli==1.1.0
cffi==1.17.1
cssselect2==0.8.0
Django==5.2.3
django-filter==25.1
djangorestframework==3.16.0
drf-yasg==1.21.10
fonttools==4.58.4
inflection==0.5.1
Jinja2==3.1.6
MarkupSafe==3.0.2
packaging==25.0
pillow==11.2.1
pycparser==2.22
pydyf==0.11.0
pyphen==0.17.2
python-dotenv==1.1.0
pytz==2025.2
PyYAML==6.0.2
sqlparse==0.5.3
tinycss2==1.4.0
tinyhtml5==2.0.0
tzdata==2025.2
uritemplate==4.2.0
weasyprint==65.1
webencodings==0.5.1
zopfli==0.2.3.post1
Затем установите их:

Bash

pip install -r requirements.txt
4. Настройка базы данных и применение миграций
Проект использует SQLite3. Файл базы данных db.sqlite3 будет создан автоматически в корневой директории проекта при выполнении команды migrate. Вам не нужно создавать его вручную.

Bash

python manage.py makemigrations sales
python manage.py migrate
5. Запуск сервера разработки
Bash

python manage.py runserver
Теперь приложение должно быть доступно по адресу http://127.0.0.1:8000/.

Описание API
Проект предоставляет RESTful API для управления продажами. Поскольку в проекте настроен AllowAny для разрешений и отключена аутентификация, вы можете получить доступ к API без какой-либо авторизации.

Вы можете ознакомиться с полной интерактивной документацией API, используя Swagger UI.

Доступ к Swagger UI
После запуска сервера перейдите по адресу:

http://127.0.0.1:8000/swagger/

Здесь вы найдете полный список доступных эндпоинтов, их параметры, примеры запросов и ответов, а также сможете выполнять запросы непосредственно из браузера.

Примеры основных эндпоинтов (доступны через Swagger UI):
Управление клиентами:

GET /api/customers/: Получить список всех клиентов.

POST /api/customers/: Создать нового клиента.

GET /api/customers/{id}/: Получить детали клиента по ID.

PUT /api/customers/{id}/: Обновить данные клиента по ID.

DELETE /api/customers/{id}/: Удалить клиента по ID.

Управление продуктами:

GET /api/products/: Получить список всех продуктов.

POST /api/products/: Создать новый продукт.

GET /api/products/{id}/: Получить детали продукта по ID.

PUT /api/products/{id}/: Обновить данные продукта по ID.

DELETE /api/products/{id}/: Удалить продукт по ID.

Управление заказами:

GET /api/orders/: Получить список всех заказов.

POST /api/orders/: Создать новый заказ.

GET /api/orders/{id}/: Получить детали заказа по ID.

PUT /api/orders/{id}/: Обновить заказ по ID.

PATCH /api/orders/{id}/status/: Обновить статус заказа по ID (например, на confirmed).

Генерация отчетов:

GET /api/reports/sales/?start=YYYY-MM-DD&end=YYYY-MM-DD: Сгенерировать PDF-отчет по продажам за указанный период.

Пример: http://127.0.0.1:8000/api/reports/sales/?start=2023-01-01&end=2023-12-31

Пример запроса на создание заказа:
POST /api/orders/

JSON

{
    "customer_id": 1,
    "status": "draft",
    "delivery_cost": 500,
    "tax_percent": 12,
    "items": [
        {
            "product_id": 1,
            "quantity": 2
        },
        {
            "product_id": 2,
            "quantity": 1
        }
    ]
}
Пример запроса на обновление статуса заказа:
PATCH /api/orders/1/status/ (для заказа с ID 1)

JSON

{
    "status": "confirmed"
}
Примеры PDF-отчета
Пример PDF-отчета будет доступен для скачивания непосредственно по ссылке, сгенерированной вашим API. Например, после запуска сервера вы можете получить отчет, перейдя по следующему адресу (замените даты на нужный вам диапазон):

http://127.0.0.1:8000/api/reports/sales/?start=2023-01-01&end=2023-12-31
